<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultima Underworld - Interactive Map</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="title">
                <span class="title-main">Ultima Underworld</span>
                <span class="title-sub">The Stygian Abyss</span>
            </h1>
            <div class="header-controls">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search objects...">
                    <span class="search-icon">üîç</span>
                </div>
                <div class="save-game-controls">
                    <label class="save-game-toggle" id="show-changes-badges-toggle" style="display: none;" title="Change indicators: ON (click to hide)" aria-pressed="true">
                        <input type="checkbox" id="show-changes-badges-checkbox" checked>
                        <svg class="toggle-icon" viewBox="0 0 24 24" width="14" height="14" role="img" aria-label="Delta">
                            <path class="toggle-triangle" d="M12 4L20 20H4L12 4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                        </svg>
                    </label>
                    <select id="save-game-selector" class="save-game-selector">
                        <option value="">Base Game</option>
                    </select>
                    <div class="save-game-actions">
                        <input type="file" id="save-game-input" webkitdirectory directory multiple style="display: none;" accept=".ark,.dat">
                        <button type="button" id="load-save-btn" class="save-game-btn" title="Load Save Game Directory">
                            üìÅ Load Save
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar - Filters -->
            <aside class="sidebar filters-sidebar">
                <div class="sidebar-scrollable">
                    <div class="sidebar-section">
                        <h3 class="section-title">Level</h3>
                        <div class="level-tabs" id="level-tabs">
                            <!-- Level tabs will be populated by JS -->
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="section-title">Special Filters</h3>
                        <div class="special-filters">
                            <label class="special-filter enchanted-filter">
                                <input type="checkbox" id="enchanted-filter">
                                <span class="filter-icon">‚ú®</span>
                                <span class="filter-label">Enchanted Only</span>
                                <span class="filter-count" id="enchanted-count">0</span>
                            </label>
                            <div class="special-filter owned-items-filter" id="owned-items-filter">
                                <div class="owned-items-header" id="owned-items-header">
                                    <span class="filter-icon">üîí</span>
                                    <span class="filter-label" id="owned-items-label">All Items</span>
                                    <span class="dropdown-arrow">‚ñº</span>
                                </div>
                                <div class="owned-items-dropdown collapsed" id="owned-items-dropdown">
                                    <!-- Options populated by JS -->
                                </div>
                            </div>
                            <div class="special-filter change-types-filter" id="change-types-filter" style="display: none;">
                                <div class="change-types-header" id="change-types-header">
                                    <span class="filter-icon">üîÄ</span>
                                    <span class="filter-label" id="change-types-label">All Changes</span>
                                    <span class="dropdown-arrow" id="change-types-arrow">‚ñº</span>
                                </div>
                                <div class="change-types-dropdown collapsed" id="change-types-dropdown">
                                    <!-- Change type checkboxes populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="section-header">
                            <h3 class="section-title">NPCs</h3>
                            <div class="category-toggle-btns">
                                <button class="toggle-btn" id="select-all-npcs" title="Select All">All</button>
                                <button class="toggle-btn" id="deselect-all-npcs" title="Deselect All">None</button>
                            </div>
                        </div>
                        <div class="category-filters" id="npc-filters">
                            <!-- NPC category checkboxes will be populated by JS -->
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="section-header">
                            <h3 class="section-title">Items</h3>
                            <div class="category-toggle-btns">
                                <button class="toggle-btn" id="select-all-items" title="Select All">All</button>
                                <button class="toggle-btn" id="deselect-all-items" title="Deselect All">None</button>
                            </div>
                        </div>
                        <div class="category-filters" id="item-filters">
                            <!-- Item category checkboxes will be populated by JS -->
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="section-header">
                            <h3 class="section-title">World</h3>
                            <div class="category-toggle-btns">
                                <button class="toggle-btn" id="select-all-world" title="Select All">All</button>
                                <button class="toggle-btn" id="deselect-all-world" title="Deselect All">None</button>
                            </div>
                        </div>
                        <div class="category-filters" id="world-filters">
                            <!-- World category checkboxes will be populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="sidebar-section sidebar-stats">
                    <h3 class="section-title">Statistics</h3>
                    <div class="stats-display" id="stats-display">
                        <div class="stat-item">
                            <span class="stat-label">Total Items:</span>
                            <span class="stat-value" id="stat-objects">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Markers:</span>
                            <span class="stat-value" id="stat-visible">-</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Map Container -->
            <div class="map-container" id="map-container">
                <div class="map-wrapper" id="map-wrapper">
                    <img id="map-image" class="map-image" src="" alt="Level Map">
                    <svg id="markers-layer" class="markers-layer"></svg>
                    <div id="tile-highlight" class="tile-highlight"></div>
                </div>
                
                <!-- Zoom Controls -->
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoom-in" title="Zoom In">+</button>
                    <span class="zoom-level" id="zoom-level">100%</span>
                    <button class="zoom-btn" id="zoom-out" title="Zoom Out">‚àí</button>
                    <button class="zoom-btn" id="zoom-reset" title="Reset">‚ü≤</button>
                    <button class="zoom-btn" id="zoom-lock" title="Lock View (Zoom & Pan)">üîí</button>
                </div>

                <!-- Coordinate Display -->
                <div class="coord-display" id="coord-display">
                    <span class="coord-label">Tile:</span>
                    <span class="coord-value" id="coord-value">‚Äî</span>
                </div>

                <!-- Loading Overlay -->
                <div class="loading-overlay" id="loading-overlay">
                    <div class="loading-spinner"></div>
                    <p>Loading map data...</p>
                </div>
            </div>

            <!-- Sidebar - Details -->
            <aside class="sidebar details-sidebar" id="details-sidebar">
                <!-- Content dynamically populated by JS -->
            </aside>
        </main>

        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>

        <!-- Footer -->
        <footer class="app-footer">
            <p>Data extracted from Ultima Underworld: The Stygian Abyss (1992) by Looking Glass Technologies</p>
        </footer>
    </div>

    <!-- Client-side save game parsing for static hosting (GitHub Pages) -->
    <script src="js/ownership.js?v=1"></script>
    <script src="js/save-parser.js?v=8"></script>
    <script src="js/save-comparator.js?v=15"></script>
    <script src="js/app.js?v=35"></script>
</body>
</html>

